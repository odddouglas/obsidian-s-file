#### 引脚定义
![[STM32F103C8T6引脚定义.png]]
#### 启动文件配置

- 收集必要的启动文件放入项目的`Startup`中 （没有`Startup`则新建）
```
E:\ODDDOUGLAS\maxi-file\32\firmwareLib\STM32F10x_StdPeriph_Lib_V3.5.0\Libraries\CMSIS\CM3
```

```
//提供DeviceSupport

startup stm32f10x cl.s //arm的启动文件,这些需要选择，每一个项目只会配置一个启动文件,下面有说
startup stm32f10x hd.s
startup stm32f10x hd vl.s
startup stm32f10x ld.s
startup stm32f10x ld vl.s
startup stm32f10x md.s
startup stm32f10x md vl.s
startup stm32f10x xl.s

stm32f10x.h    //STM32的外设寄存器描述文件，作用类似于51中的头文件REGX52.H，描述其有哪些寄存器和它想对应的地址
system stm32f10x.c
system stm32f10x.h


//提供CoreSuport

core cm3.c  //提供内核寄存器描述文件
core cm3.h


最终(共6个文件)
```

- 进入魔法棒中的`c/c++`的`IncludePaths`一栏中, 添加当前项目的`Startup`文件

- 根据型号和Flash的容量需求来选择, 103系列要选不带VL的, 选大的

| 缩写  | 释义               | Flash容量 | 型号              |
| ----- | ------------------ | --------- | ----------------- |
| LD_VL | 小容量产品超值系列 | 16~32K    | STM32F100         |
| MD_VL | 中容量产品超值系列 | 64~128K   | STM32F100         |
| HD_VL | 大容量产品超值系列 | 256~512K  | STM32F100         |
| LD    | 小容量产品         | 16~32K    | STM32F101/102/103 |
| MD    | 中容量产品         | 64~128K   | STM32F101/102/103 |
| HD    | 大容量产品         | 256~512K  | STM32F101/102/103 |
| XL    | 加大容量产品       | 大于512K  | STM32F101/102/103 |
| CL    | 互联型产品         | -         | STM32F105/107     |

#### 仿真
- `GEEHY-LINK`是一款仿真器和编程器一体化的开发工具，
	可以在`keil`集成开发环境下对`APM32`全系列`MCU`产品进行在线调试仿真,`Debug`配置中对应`CMSIS-DAP Debugger`
	支持全速运行、单步调试和断点设置等各种调试方式。

#### 寄存器配置

- 定时器APB2外设时钟使能寄存器 `RCC_APB2ENR
	- IO端口C时钟使能位 `IOPCEN`(`I/O port C clock enable`)：
```c
RCC->APB2ENR = 0x00000010;  

0000 0000 0000 0000 0000 0000 [0001] 0000
//此时IOPCEN位被置为1，此时开启
```
- 端口配置高寄存器`(GPIOx_CRH) (x=A..E)` 
	- 端口x配置位(y = 8…15,这里取13)`CNFy[1:0]` (`Port x configuration bits`)
	- 端口x的模式位(y = 8…15,这里取13) `MODEy[1:0]` (`Port x mode bits`) 
```c
GPIOC->CRH = 0x00300000;

0000 0000 [0011] 0000 0000 0000 0000 0000 
//此时CNF13配置为00(通用推挽输出模式)
//此时MODE13配置为11(输出模式,调整最大速度为50MHz)
```
- 端口输出数据寄存器(`GPIOx_ODR`) (`x=A..E`)
	- 端口输出数据(y = 0…15,这里取) `ODRy[15:0] `(`Port output data`)
```c
GPIOC->ODR = 0x00002000;

0000 0000 0000 0000 [0010] 0000 0000 0000
//此时ODR13配置为1(输出到13引脚),看到上面预留了16位,感觉是来缓存数据的
```


#### 库函数配置(标准外设库)
- 复制库到工程文件中的`Library`
```
E:\ODDDOUGLAS\maxi-file\32\firmwareLib\STM32F10x_StdPeriph_Lib_V3.5.0\Libraries\STM32F10x_StdPeriph_Driver\src
E:\ODDDOUGLAS\maxi-file\32\firmwareLib\STM32F10x_StdPeriph_Lib_V3.5.0\Libraries\STM32F10x_StdPeriph_Driver\inc
```

```
misc.c
misc.h
stm32f10x adc.c
stm32f10x adc.h
stm32f10x bkp.c
stm32f10x bkp.h
stm32f10x can.c
stm32f10x can.h
stm32f10x cec.c
stm32f10x cec.h
stm32f10x crc.c
stm32f10x crc.h
stm32f10x dac.c
stm32f10x dac.h
stm32f10x dbgmcu.c
stm32f10x dbgmcu.h
stm32f10x dma.c
stm32f10x dma.h
stm32f10x exti.c
.
.
.(还有很多)

```

- 复制库的必要文件到`User`这一代码文件夹中
```
E:\ODDDOUGLAS\maxi-file\32\firmwareLib\STM32F10x_StdPeriph_Lib_V3.5.0\Project\STM32F10x_StdPeriph_Template
(找到提供模板下的三个文件)
```

```
stm32f10x conf.h // 配置库文件包含关系的配置文件以及库函数参数检查
stm32f10x it.c // 用来存放中断服务函数的
stm32f10x it.h

最后加上要写的main.c就是4个文件
```

- 进入魔法棒中的`c/c++`的`Define`一栏中, 粘贴这段被定义的字符串` USE_STDPERIPH_DRIVER`
	- 这个标准外设库的字符串还是要看头文件中是定义了什么字符串
	- 可以跳转到`stm32f10x.h`(也就是`main`函数使用的头文件)中, 查看以下的一段条件编译
```c

#ifdef USE_STDPERIPH_DRIVER
   #include "stm32f10x_conf.h"
#endif
```

-  进入魔法棒中的`c/c++`的`IncludePaths`一栏中, 补充当前项目的`Library` 和`User`文件,这样就可以识别该路径文件的头文件

## 通用输入输出
#### GPIO（General Purpose Input Output）

- 通用输入输出,可配置为8种输入输出模式
- 引脚电平：0V~3.3V，部分引脚可容忍5V
	- 输出模式下可控制端口输出高低电平，用以驱动LED、控制蜂鸣器、模拟通信协议输出时序等
	- 输入模式下可读取端口的高低电平或电压，用于读取按键输入、外接模块电平信号输入、ADC电压采集、模拟通信协议接收数据等


#### 上拉，下拉，浮空三种输入模式
- 在GPIO (通用输入/输出) 接口中，上拉电阻和下拉电阻是用来控制输入引脚的电气状态的元件，通常用于微控制器和单板计算机等嵌入式系统中。它们的作用是确保输入引脚在没有外部输入时保持特定的电平状态，以防止干扰和漂移。

1. **上拉输入（Pull-Up Input）**：
    - 上拉输入是一种配置，其中输入引脚通过上拉电阻与高电平（通常电源电压Vcc）连接。
    - 这意味着当没有外部信号驱动输入引脚时，输入引脚会保持高电平。
    - 上拉输入通常用于数字输入，如开关、按钮或传感器，以确保在没有外部信号时，引脚保持高电平状态。当外部设备连接到引脚时，引脚可以轻松地检测到低电平。

1. **下拉输入（Pull-Down Input）**：
    - 下拉输入是一种配置，其中输入引脚通过下拉电阻与地连接。
    - 这意味着当没有外部信号驱动输入引脚时，输入引脚会保持低电平。
    - 下拉输入通常用于数字输入，如开关、按钮或传感器，以确保在没有外部信号时，引脚保持低电平状态。当外部设备连接到引脚时，引脚可以轻松地检测到高电平。

2. **浮空输入（Floating Input）**：
    - 浮空输入是一种配置，其中输入引脚既没有上拉电阻也没有下拉电阻连接。
    - 这意味着输入引脚没有明确的电平状态，而是处于开路状态，不连接到高电平或地。
    - 浮空输入通常用于数字输入，当外部设备的状态对于系统不重要时，或者当需要特别注意避免干扰时。这允许外部电路或其他设备自行确定引脚状态，但也可能会导致不稳定的状态或电磁干扰问题。
#### 斯密特触发器（Schmitt Trigger）

- 斯密特触发器是一种特殊的数字电路元件，具有整形的作用
- 用于将不稳定或噪声干扰的输入信号转换为干净的数字信号输出。
- 它有两个输出状态，通常是高电平（逻辑1）和低电平（逻辑0），以确保输入信号的逻辑电平在给定的阈值范围内稳定切换。
	- 斯密特触发器常用于去抖动开关和按钮信号，以确保只有在稳定按下或释放按钮后才会引发状态变化。
	- 它还可以用于信号整形和稳定化，以处理不稳定或噪声干扰的输入信号。
	- 斯密特触发器也用于振荡电路和频率分频器等应用，以产生稳定的方波输出

#### 位设置/清除寄存器和输出数据寄存器
1. 配置GPIO引脚： 首先，程序员需要配置GPIO引脚的功能，例如输入或输出。这通常涉及设置相应的引脚模式寄存器。如果引脚被配置为输出，程序员通常会将位设置清除寄存器用于设置引脚的初始状态。
    
2. 使用位设置/清除寄存器：
    - 通过位设置清除寄存器，程序员可以设置或清除单个或多个引脚的状态。这通常涉及将特定位设置为1以设置引脚为高电平，或将特定位清除为0以设置引脚为低电平。
    - 位设置清除寄存器允许程序员以位操作的方式控制引脚的状态，而不会影响其他引脚

3. 使用输出数据寄存器：
    - 输出数据寄存器允许程序员一次性设置整个GPIO端口的输出状态。这是一个更高级别的控制方法，可以用于设置多个引脚的状态。
    - 通过向输出数据寄存器写入特定的值，可以同时设置或清除多个引脚的状态，以实现一致的输出。

#### 推挽，开漏，关闭三种输出模式
- 推挽（Push-Pull）、开漏（Open-Drain）和关闭（Floating）是关于数字输出的常见电路配置，通常与微控制器、数字逻辑门或其他数字电子设备相关。它们用于控制输出引脚的电平状态和电气连接方式。

1. 推挽（Push-Pull）输出：
    - 推挽输出是一种常见的数字输出配置，其中输出引脚可以提供两种状态：高电平（通常是Vcc或高电压）和低电平（通常是地或低电压）。
    - 在推挽输出模式下，输出引脚被连接到悬空电源（高电平）和地，可以提供较强的输出电流，适用于驱动外部负载。
    - 推挽输出适用于需要输出明确的高和低电平信号的情况，如控制电机、LED、继电器等。
2. 开漏（Open-Drain）输出：
    - 开漏输出是一种数字输出配置，其中输出引脚只能提供低电平信号。 输出引脚在高电平状态时处于高阻抗状态，不提供高电平信号（无驱动能力），只能通过外部上拉电阻连接到电源电压来提供高电平。
    - 开漏输出适用于需要实现多个输出引脚的共享或总线通信的情况，其中多个开漏输出可以连接在一起，以实现逻辑“与”操作。
    - 在开漏输出模式下，输出引脚通常用于驱动开漏（漏电）器件，如I2C总线。
3. 关闭（Floating）：
    - 关闭是一种没有明确电平的输出状态，输出引脚既不处于高电平状态也不处于低电平状态。
    - 关闭状态下，输出引脚通常处于高阻抗状态，没有明确的电流流动。这允许外部电路或其他设备自行确定引脚状态。
    - 通常，在数字系统中，关闭状态并不常见，但在某些情况下可能会出现，例如在特殊通信协议中。

- 这三种输出模式可以根据特定应用的需求来选择，以实现不同的电平控制和连接方式。推挽适合需要明确高和低电平输出的情况，开漏适合多路设备的共享或总线通信，而关闭状态通常是在输入模式开启时输出模式的状态，需要特别考虑。

#### 输入输出模式一览
| 模式名称     | 性质     | 特征                                               |
| ------------ | -------- | -------------------------------------------------- |
| 浮空输入     | 数字输入 | 可读取引脚电平，若引脚悬空，则电平不确定           |
| 上拉输入     | 数字输入 | 可读取引脚电平，内部连接上拉电阻，悬空时默认高电平 |
| 下拉输入     | 数字输入 | 可读取引脚电平，内部连接下拉电阻，悬空时默认低电平 |
| 模拟输入     | 模拟输入 | GPIO无效，引脚直接接入内部ADC                      |
| 开漏输出     | 数字输出 | 可输出引脚电平，高电平为高阻态，低电平接VSS        |
| 推挽输出     | 数字输出 | 可输出引脚电平，高电平接VDD，低电平接VSS           |
| 复用开漏输出 | 数字输出 | 由片上外设控制，高电平为高阻态，低电平接VSS        |
| 复用推挽输出 | 数字输出 | 由片上外设控制，高电平接VDD，低电平接VSS           |

#### 高低电平驱动规则  
1. 高电平弱驱动（High-Level Weak Drive）：
    - 指的是当输出引脚处于高电平状态时，输出引脚提供的电流相对较小。
    - 这意味着输出引脚在高电平状态下无法提供大电流，通常适用于连接到高阻抗输入的电路或设备。
    - 在高电平状态下，输出引脚的电流输出能力较弱，因此不能为外部负载提供大电流。

1. 低电平强驱动（Low-Level Strong Drive）：
    - 指的是当输出引脚处于低电平状态时，输出引脚提供的电流相对较大。
    - 这意味着输出引脚在低电平状态下可以提供较大的电流，通常适用于需要在低电平状态下提供足够电流的应用，如驱动LED、电机或其他需要较强电流的负载。
    - 在低电平状态下，输出引脚的电流输出能力较强，可以为外部负载提供足够的电流。

#### 十六进制和三十二进制

- 
```c
typedef struct
{
	uint32_t CRL;
	uint32_t CRH;
	uint32_t IDR;
	uint32_t ODR;
	uint32_t BSRR;
	uint32_t BRR;
	
}GPIO_TypeDef;


void GPIO SetBits (GPIO_TypeDef *GpIOx, uint16_t GPIO_Pin)
{
	GPIOx->BSRR=GPIO_Pin: //下16位赋值过去，32位的变量中的上16位就会被置零
}
```

#### 数据类型重预览
| 关键字             | 位数 | 表示范围                 | stdint关键字 | ST关键字 |
| ------------------ | ---- | ------------------------ | ------------ | -------- |
| char               | 8    | -128 ~ 127               | int8_t       | s8       |
| unsigned char      | 8    | 0 ~ 255                  | uint8_t      | u8       |
| short              | 16   | -32768 ~ 32767           | int16_t      | s16      |
| unsigned short     | 16   | 0 ~ 65535                | uint16_t     | u16      |
| int                | 32   | -2147483648 ~ 2147483647 | int32_t      | s32      |
| unsigned int       | 32   | 0 ~ 4294967295           | uint32_t     | u32      |
| long               | 32   | -2147483648 ~ 2147483647 |              |          |
| unsigned long      | 32   | 0 ~ 4294967295           |              |          |
| long long          | 64   | -(2^64)/2 ~ (2^64)/2-1   | int64_t      |          |
| unsigned long long | 64   | 0 ~ (2^64)-1             | uint64_t     |          |
| float              | 32   | -3.4e38 ~ 3.4e38         |              |          |
| double             | 64   | -1.7e308 ~ 1.7e308       |              |          |



## 外部中断
![[Pasted image 20231031153052.png]]
#### 触发外部中断的基本流程

1. **外部中断线（External Interrupt Lines）**：STM32微控制器通常具有多个外部中断线，通常称为EXTI线。这些线用于连接外部事件源，如按键、传感器或其他外部设备。外部中断线通常与GPIO引脚关联，可以配置为触发外部中断。
    
2. **外部中断控制器（External Interrupt Controller，EXTI）**：EXTI外设用于配置外部中断线的触发方式，例如上升沿触发、下降沿触发或边沿触发。它还允许您使能或禁用特定的外部中断线。
    
3. **中断控制器（Nested Vectored Interrupt Controller，NVIC）**：NVIC是STM32上的中断控制器，用于管理中断优先级和中断向量表。在配置外部中断时，您需要将相应的中断通道分配给外部中断线，并设置中断优先级。
    
4. **中断服务函数（Interrupt Service Routine，ISR）**：一旦外部中断被触发，STM32将自动调用与该中断相关联的中断服务函数。开发者需要编写这些ISR以响应中断事件，例如处理按键事件、传感器数据等。

#### EXTI边沿检测及控制
- EXTI（Extern Interrupt）外部中断I可以监测指定GPIO口的电平信号，
	- 当其指定的GPIO口产生电平变化时，EXTI将立即向NVIC发出中断申请，经过NVIC裁决后即可中断CPU主程序，使CPU执行EXTI对应的中断程序
	- 支持的触发方式：上升沿/下降沿/双边沿/软件触发
	- 支持的GPIO口：所有GPIO口，注意！相同的Pin不能同时触发中断！
	- 通道数：16个GPIO_Pin，外加PVD输出、RTC闹钟、USB唤醒、以太网唤醒
	- 触发响应方式：中断响应/事件响应(这个事件响应是指EXTI触发之后不进行中断响应，而是触发别的外设操作，属于是外设之间的联合工作)

#### NVIC优先级分组

- NVIC的中断优先级由优先级寄存器的4位（0~15），值越小，优先级越高，这4位可以进行切分，分为高n位的抢占优先级和低4-n位的响应优先级
	- 抢占优先级高的可以中断嵌套，响应优先级高的可以优先排队，抢占优先级和响应优先级均相同的按中断号排队
 
| 分组方式 | 抢占优先级      | 响应优先级      |     |
| -------- | --------------- | --------------- | --- |
| 分组0    | 0位，取值为0    | 4位，取值为0~15 |     |
| 分组1    | 1位，取值为0~1  | 3位，取值为0~7  |     |
| 分组2    | 2位，取值为0~3  | 2位，取值为0~3  |     |
| 分组3    | 3位，取值为0~7  | 1位，取值为0~1  |     |
| 分组4    | 4位，取值为0~15 | 0位，取值为0    |     |


#### 逻辑门基础
- 与门其实是一个开关的作用, 是因为其工作原理类似于一个开关或触发器，只有在特定的输入条件下才会产生输出。与门有两个或多个输入引脚和一个输出引脚。其输出只有在所有输入引脚都为逻辑1时才为逻辑1，否则输出为逻辑0

## 定时中断
![[Pasted image 20231031153130.png]]

#### TIM定时器
- TIM（Timer）定时器可以对输入的时钟进行计数，并在计数值达到设定值时触发中断(定时器本质就是一个计数器)
	- 16位计数器、预分频器、自动重装寄存器的时基单元，在72MHz计数时钟下可以实现最大59.65s的定时
	- 不仅具备基本的定时中断功能，而且还包含内外时钟源选择、输入捕获、输出比较、编码器接口、主从触发模式等多种功能
	- 根据复杂度和应用场景分为了高级定时器、通用定时器、基本定时器三种类型

   
| 类型           | 编号                   | 总线 | 功能                                                                                                 |     |
| ---------- | ---------------------- | ---- | ---------------------------------------------------------------------------------------------------- | --- |
| 高级定时器 | TIM1、TIM8             | APB2 | 拥有通用定时器全部功能，并额外具有重复计数器、死区生成、互补输出、刹车输入等功能                     |     |
| 通用定时器 | TIM2、TIM3、TIM4、TIM5 | APB1 | 拥有基本定时器全部功能，并额外具有内外时钟源选择、输入捕获、输出比较、编码器接口、主从触发模式等功能 |     |
| 基本定时器 | TIM6、TIM7             | APB1 | 拥有定时中断、主模式触发DAC的功能                                                                    |     |

- 预分频器: 分频就是把72MHz分为你想要的频率，比如1MHz，每周期1us，这样便于计算，分频应该是规定单位时间长度的 
	- 预分频器为了防止计数中途更改数值造成错误,设计了缓冲寄存器(影子寄存器)
- 自动重装器: 51是设定计数的初始值，而32是设定计数器结束的值
- 计时器向上计数,达到终值,产生更新中断和更新事件,值得一提的是,计时器还有向下计数(达到0为终值)模式和中央对齐模式(向上达到重装值申请中断,向下达到0又申请中断)
	- 计时器有一个主模式的作用: 就是相当于计数器到了重装载值 产生了一个更新事件(并不触发中断)，然后内部硬件映射到TRGO(TriggerOut)，通过TRGO来自动触发DAC转换，不再需要再到定时器中断里再去执行读取DAC(数模转换器)数值了。
	- 通用定时器如果要使用外部时钟,首选ETR引脚外部时钟模式2的输入
	- 高级定时器比通用定时器多了一个重复次数计时器
	- 计数器有无预装时序就是有无缓冲寄存器

#### 计时器时序计算

- 计数器计数频率：$$CK\_CNT = \frac{CK\_PSC} {(PSC + 1)}$$
- 计数器溢出频率：$$CK\_CNT\_OV = \frac{CK\_CNT} {(ARR + 1)} = \frac{CK\_PSC}{(PSC + 1)}×\frac{1}{(ARR + 1)}$$

## 输出比较

![[Pasted image 20231111230517.png]]
![[Pasted image 20231111230526.png]]
#### 输出比较(Output Compare)


- 输出比较可以通过比较CNT与CCR寄存器值的关系，来对输出电平进行置1、置0或翻转的操作，用于输出一定频率和占空比的PWM波形
	- 每个高级定时器和通用定时器都拥有4个输出比较通道(即CCR), 只能使用其中一个, 不能同时使用
	- 不能在基本定时器上进行输出比较,因为基本定时器没有CCR寄存器
	- 主要学习通用定时器
	- 高级定时器的前3个通道额外拥有死区生成和互补输出的功能

#### PWM(Pulse Width Modulation)
![[Pasted image 20231103202617.png]]
- 在具有惯性(电机断电时也就是低电平状态时,不会立马停止,LED熄灭时不会立马熄灭)的系统中，可以通过对一系列脉冲的宽度进行调制，来等效地获得所需要的模拟参量，常应用于电机控速等领域
- 为了等效的输出一个模拟信号,调整频率,来控制亮LED亮度或者电机速度
	- 占空比越大,等效的模拟信号就越趋近于低电平
	- 占空比越大,等效的模拟信号就越趋近于高电平
- PWM的参数有 $频率=\frac{1}{T_{ON}+T_{OFF}}$  $占空比=\frac{T_{ON}}{{T_{ON}+{T_{OFF}}}}$ $分辨率=占空比变化步距$ 

| 模式             | 描述                                                                                                                             |     | 
| ---------------- | -------------------------------------------------------------------------------------------------------------------------------- | --- |
| 冻结             | CNT=CCR时，REF保持为原状态                                                                                                       |     |
| 匹配时置有效电平 | CNT=CCR时，REF置有效电平                                                                                                         |     |
| 匹配时置无效电平 | CNT=CCR时，REF置无效电平                                                                                                         |     |
| 匹配时电平翻转   | CNT=CCR时，REF电平翻转                                                                                                           |     |
| 强制为无效电平   | CNT与CCR无效，REF强制为无效电平                                                                                                  |     |
| 强制为有效电平   | CNT与CCR无效，REF强制为有效电平                                                                                                  |     |
| PWM模式1         | 向上计数：CNT<CCR时，REF置有效电平，CNT≥CCR时，REF置无效电平<br><br>向下计数：CNT>CCR时，REF置无效电平，CNT≤CCR时，REF置有效电平 |     |
| PWM模式2         | 向上计数：CNT<CCR时，REF置无效电平，CNT≥CCR时，REF置有效电平<br><br>向下计数：CNT>CCR时，REF置有效电平，CNT≤CCR时，REF置无效电平 |     |

#### PWM参数计算
 $$PWM频率: Freq=\frac{CK\_PSC}{PSC+1}×\frac{1}{ARR+1}$$
$$PWM占空比:Duty = \frac{CCR}{ARR+1}$$
$$PWM分辨率: Reso= \frac{1}{ARR+1}$$

## 输入捕获
![[Pasted image 20231111230614.png]]

#### 输入捕获(Input Capture)

- 输入捕获模式下，当通道输入引脚出现指定电平跳变时，当前CNT的值将被锁存到CCR中，可用于测量PWM波形的频率、占空比、脉冲间隔、电平持续时间等参数
	- 每个高级定时器和通用定时器都拥有4个输入捕获通道(即CCR), 只能使用其中一个, 不能同时使用
	- 可配置为PWMI模式，同时测量频率和占空比
	- 可配合主从触发模式，实现硬件全自动测量

#### 频率测量
![[Pasted image 20231105210947.png]]

- 测频法：在闸门时间 $T$ 内，对上升沿计次，得到 $N$，则频率
	- 如果频率过低,设定的闸门时间内都没有几个上升沿计次
	- 该方法中,高频会自动被均值滤波处理(避免毛刺信号误触发), 最后得到的是一段时间的平均值, 测量结果慢, 但是结果值比较平滑
$$f_x=N / T\quad (适用高频率)$$

- 测周法：两个上升沿内(也就是一个周期)，以标准频率 $f_c$ 计次，得到 $N$ ，则频率
	- 如果频率过高,周期就比较短,此时标准 $f_C$ 计次就比较少
	- 该方法结果更新较快, 但是由于该方法只测一个周期, 测量值会受噪声的影响,波动比较大
$$f_x=f_c  / N \quad(适用低频率)$$

- 中界频率：测频法与测周法误差相等的频率点(令两个方法定义式中的)
	- 多高算高频率,多低算低频率, 此时就需要中界频率了
	- 正负一误差是以上两个方法都固有的误差, 为了减小该误差影响, 只能尽可能多计一些数
$$f_m=√(f_c  / T)$$
#### 捕获的基本过程

1. 进行信号的滤波 ( 输入捕获数字滤波器 )
	- 数字滤波器是由一个事件计数器组成,他记录到N个事件之后会产生一个输出的跳变
	- 工作原理就是以采样频率对输入信号进行采样, 
		- 当连续N个值都为高电平,输出才为高电平
		- 当连续N个值都为低电平,输出才为低电平
	- 这样就可以滤除那些高电平脉宽低于8个采样周期的脉冲信号，从而达到滤波的作用。
2. 设置输入捕获极性：
	- 这里是设置捕获事件是发生在上升沿还是下降沿。
3. 设置输入捕获映射关系：
	- 在`TIMx_CH1`和`TIMx_CH2`两条通道的情况下，我们可以看出除了`TIMx_CH1`捕捉到的信号可以连接到`IC1`，`TIMx_CH2`捕捉到的信号可以连接到`IC2`之外`，TIMx_CH1`捕捉到的信号也可以连接到`IC2`，`TIMx_CH2`捕捉到的信号也可以连接到`IC1`。
4. 设置输入捕获分频器：
	- 这里设置的是每N个事件触发一次捕获。也就是说，我们可以设置成，每2次上升沿事件触发一次捕获。
5. 捕获事件：
	- 通过检测TIMx_CHx通道上的边沿信号，在边沿信号发生跳变（比如上升沿/下降沿）的时候，将当前定时器的值（TIMx_CNT）存放到对应的捕获/比较寄存器（TIMx_CCRx）里面，完成一次捕获。



## 模块
 
#### OLED显示屏介绍以及驱动函数

| 函数                                  | 作用                 |
| ------------------------------------- | -------------------- |
| OLED_Init();                          | 初始化               |
| OLED_Clear();                         | 清屏                 |
| OLED_ShowChar(1, 1, 'A');             | 显示一个字符         |
| OLED_ShowString(1, 3, "HelloWorld!"); | 显示字符串           |
| OLED_ShowNum(2, 1, 12345, 5);         | 显示十进制数字       |
| OLED_ShowSignedNum(2, 7, -66, 2);     | 显示有符号十进制数字 |
| OLED_ShowHexNum(3, 1, 0xAA55, 4);     | 显示十六进制数字     |
| OLED_ShowBinNum(4, 1, 0xAA55, 16);    | 显示二进制数字       |

示例如下

| 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  | 11  | 12  | 13  | 14  | 15  | 16    |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| `A`   |     | `H`   | `e`   | `l`   | `l `  | `o `  | `W `  | `o`   | `r `  | `l`   | `d`   | `!`   |     |     |     |
| `1`   | `2`   | `3`   | `4`   | `5`   |     | `-`   | `6`   | `6`   |     |     |     |     |     |     |     |
| `A`   | `A`   | `5`   | `5`   |     |     |     |     |     |     |     |     |     |     |     |     |
| `1`   | `0`   | `1`   | `0`   | `1`   | `0`   | `1`   | `0`   | `0`   | `1`   | `0`   | `1`   | `0`   | `1`   | `0`   | `1`   |


#### 传感器

- 传感器模块：传感器元件（光敏电阻/热敏电阻/红外接收管等）的电阻会随外界模拟量的变化而变化
- 通过与定值电阻分压即可得到模拟电压输出，再通过电压比较器进行二值化即可得到数字电压输出


#### 蜂鸣器介绍
- 有源蜂鸣器：内部自带振荡源，将正负极接上直流电压即可持续发声，频率固定
- 无源蜂鸣器：内部不带振荡源，需要控制器提供振荡脉冲才可发声，调整提供振荡脉冲的频率，可发出不同频率的声音

#### 旋转编码器介绍
- 当其旋转轴旋转时，其输出端可以输出与旋转速度和方向对应的方波信号
- (正交方波信号的九十度相位置前置后,可以用于判断)
- 读取方波信号的频率和相位信息即可得知旋转轴的速度和方向

#### LCD屏幕链接

| 3.2/2.8寸液晶模块（电阻屏） |            |                                                                                                          | 野火STM32开发板  |                |                |     |
| --------------------------- | ---------- | -------------------------------------------------------------------------------------------------------- | ---------------- | -------------- | -------------- | --- |
| 引脚序号                    | 引脚说明   | 引脚名称                                                                                                 | F103VE（指南者） | F103ZE（霸道） | F407（霸天虎） |     |
| 1                           | GND        | 地                                                                                                       | GND              | GND            |                |     |
| 2                           | RES        | 复位信号，低电平有效                                                                                     | PE1              | PG11           | PF11           |     |
| 3                           | D15        | 数据15                                                                                                   | PD10             | PD10           | PD10           |     |
| 4                           | D14        | 数据14                                                                                                   | PD9              | PD9            | PD9            |     |
| 5                           | D13        | 数据13                                                                                                   | PD8              | PD8            | PD8            |     |
| 6                           | D12        | 数据12                                                                                                   | PE15             | PE15           | PE15           |     |
| 7                           | D11        | 数据11                                                                                                   | PE14             | PE14           | PE14           |     |
| 8                           | D10        | 数据10                                                                                                   | PE13             | PE13           | PE13           |     |
| 9                           | D09        | 数据9                                                                                                    | PE12             | PE12           | PE12           |     |
| 10                          | D08        | 数据8                                                                                                    | PE11             | PE11           | PE11           |     |
| 11                          | D07        | 数据7                                                                                                    | PE10             | PE10           | PE10           |     |
| 12                          | D06        | 数据6                                                                                                    | PE9              | PE9            | PE9            |     |
| 13                          | D05        | 数据5                                                                                                    | PE8              | PE8            | PE8            |     |
| 14                          | D04        | 数据4                                                                                                    | PE7              | PE7            | PE7            |     |
| 15                          | D03        | 数据3                                                                                                    | PD1              | PD1            | PD1            |     |
| 16                          | D02        | 数据2                                                                                                    | PD0              | PD0            | PD0            |     |
| 17                          | D01        | 数据1                                                                                                    | PD15             | PD15           | PD15           |     |
| 18                          | D00        | 数据0                                                                                                    | PD14             | PD14           | PD14           |     |
| 19                          | RD         | 读数据信号，低电平有效                                                                                   | PD4              | PD4            | PD4            |     |
| 20                          | WR         | 写数据信号，低电平有效                                                                                   | PD5              | PD5            | PD5            |     |
| 21                          | RS         | 数据/命令信号，高电平时， D[15:0]表示的是数据(RGB  <br>像素数据或命令数据)，低电平时 D[15:0]表示控制命令 | PD11             | PE2            | PF0            |     |
| 22                          | CS         | 片选 选择NOR/SRAM块 低电平有效                                                                           | PD7              | PG12           | PG10           |     |
| 23                          | CLK  / IO1 | 电阻屏时钟：SPI_CLK                                                                                      | PE0              | PG7            | PG9            |     |
| 24                          | T_CS / IO2 | 电阻屏片选：SPI_CS                                                                                       | PD13             | PF10           | PD7            |     |
| 25                          | MOSI / IO3 | 电阻输入：SPI_MOSI                                                                                       | PE2              | PF11           | PD6            |     |
| 26                          | MISO / IO4 | 电阻屏输出：SPI_MISO                                                                                     | PE3              | PF6            | PD3            |     |
| 27                          | INT  / IO5 | 电阻屏中断：INT 低电平有效                                                                               | PE4              | PF9            | PG8            |     |
| 28                          | BK         | 背光信号，低电平点亮                                                                                     | PD12             | PG6            | PF9            |     |
| 29                          | NC         | 悬空                                                                                                     | NC               | NC             | NC             |     |
| 30                          | NC         | 悬空                                                                                                     | NC               | NC             | NC             |     |
| 31                          | 3V3        | 电源                                                                                                     | 3V3              | 3V3            | 3V3            |     |
| 32                          | GND        | 地                                                                                                       | GND              | GND            | GND            |     |
|                             |            |                                                                                                          |                  |                |                |     |



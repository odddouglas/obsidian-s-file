

#### 项目架构
![image.png](https://s2.loli.net/2023/07/12/UvLVikB3AZGxraD.png)



#### 多媒体定时器

- 定时器需要设定好一定的分辨率和时间间隔，如分辨率为1毫秒，时间间隔为10毫秒，从0计数到9，即计数到10毫秒时，执行某项任务，如果是循环定时器那么定时器清零，继续开始计数，计到9时，再次执行某项任务。
- 在Windows编程中，有两种定时器:普通定时器和多媒体定时器。普通定时器的精度低，而多媒体定时器的精度高，这里只介绍多媒体定时器:
	- 多媒体定时器在使用时，先设定好延时周期、精度、回调函数、回调数据和定时器事件类型，
	- 定时器事件类型一般配置为周期性触发 (TIME_PERIODIC)

#### 关于头文件
- 头文件（Header file）通常用于在C++编程中声明函数、类、变量和常量等的接口。它的主要目的是提供有关这些元素的信息，以便在其他源文件中使用它们时能够正确地引用和调用。头文件中通常包含函数的声明、类的定义、结构的定义、宏定义和常量定义等。
- 具体来说，头文件中包含以下内容：
	1. 函数声明：头文件通常包含函数的原型（函数名称、参数列表和返回类型），以便在其他源文件中使用这些函数时，编译器能够正确地解析和调用它们。函数的具体实现一般在源文件（.cpp文件）中进行定义。
	2. 类和结构的定义：头文件可以包含类和结构的定义，其中包括成员变量、成员函数以及相关的访问权限。这些定义使得其他源文件可以通过包含头文件来使用这些类和结构。
	3. 宏定义：头文件中可以定义宏，用于进行预处理指令的替换，例如定义常量、条件编译等。这些宏定义可以在源文件中使用，以便在编译时进行替换。
- 总结来说，头文件是为了提供程序中各个模块之间的接口，使得这些模块能够相互协作和正确地引用彼此。头文件一般不包含函数的具体实现，而是提供函数的声明和其他必要的定义信息。函数的具体实现通常在源文件中进行，而头文件只提供接口和定义信息。在头文件中提供函数的声明是为了在源文件之间共享函数的信息。头文件中的声明允许其他源文件在需要调用该函数时，通过包含头文件来获得函数的声明。

#### 防止重编译处理(保护宏)
在C++中，防止重编译处理是指通过一些方法来避免在每次源代码更改后都重新编译整个程序。这可以提高开发效率，尤其在大型项目中或者编译时间较长的情况下。
以下是一些常用的方法来实现防止重编译处理：
1. 头文件保护（Header Guards）：使用头文件保护宏（例如 `#ifndef`、`#define`、`#endif`）来确保头文件只被编译一次。这样可以防止在同一个编译单元中多次包含相同的头文件，避免重复定义错误。
	`#ifndef` 表示 "if not defined"，即如果给定的标识符未定义，则执行后续的代码。具体来说，`#ifndef` 用于检查一个标识符是否已经被定义，如果未定义，则执行接下来的代码块。
2. 前置声明（Forward Declaration）：如果只需要使用类型的指针或引用，可以使用前置声明代替包含完整的头文件。前置声明可以在头文件中声明，而将具体的实现留到源文件中，这样当头文件没有更改时，源文件就无需重新编译。
3. 分离接口和实现：将接口（函数声明和类定义）和实现（函数定义和成员函数实现）分开放置在不同的头文件和源文件中。这样，在接口没有更改时，只需要重新编译实现文件即可。
```cpp
#ifndef _CALC_HOUR_H_
#define _CALC_HOUR_H_

// 头文件的内容

#endif // _CALC_HOUR_H_

```
当一个源文件（或其他头文件）第一次包含`calc_hour.h`时，预处理器会发现`_CALC_HOUR_H_`未定义，于是将`#ifndef` 和 `#define` 之间的代码块编译进来。同时，预处理器会将`_CALC_HOUR_H_`定义为已定义，以避免再次包含。
当其他源文件再次包含`calc_hour.h`时，预处理器会发现`_CALC_HOUR_H_`已经定义，于是将`#ifndef` 和 `#endif` 之间的代码块跳过，以避免重复定义错误。

#### API接口
声明外部函数的一般格式如下:
```c
extern 类型名 函数名(形参列表);
```

- 外部函数可供其他文件调用。c语言规定，如果在声明函数时省略默认为外部函数。在需要调用此函数的其他文件中，需要对此函数extern作声明，而且，在对此函数作声明时，要加关键字extern，表示该函数“==是在其他文件中定义的外部函数==”
- 考虑到程序设计规范，建议内部函数均在.c文件中声明和定义，且==无论是声明还是定义，都不要省略static==。

#### 静态的生命周期和源程序相同
- 静态局部变量：非静态的局部变量会在函数结束之后消失,但是静态局部变量在函数结束之后仍然存在,只是在函数外部无法调用,作用域仍然在函数内部
- 静态全局变量:   当一个源文件由多个文件组成时,非静态的全局变量作用域为整个源程序,但是静态全局变量的作用域仅限于定义该变量的源文件.同理静态函数的作用域仅限于定义它的源文件中，这意味着其他源文件无法直接调用或访问该函数。

例如: 每次执行 `Proc2msTask()` 函数时，`s_iCnt500` 会根据逻辑进行递增或重置，但它的初始值是在第一次执行 `Proc2msTask()` 时初始化为0。之后的每次函数调用都会在上次调用的基础上进行操作，而不会重新初始化为0。
```cpp
static void Proc2msTask(void)
{
  static short s_iCnt500 = 0;

  TickPer2Ms();//里面有一个s_icnt在记录时间,记录的是sec

  if (s_iCnt500 >= 499)
  {
    Proc1SecTask();//里面有一个GetTickVal函数在时刻提取TickPer2Ms中递增的tick值,得到该值之后这个ProclSecTask将其转换成时间值打印出信息
    s_iCnt500 = 0;
  }
  else
  {
    s_iCnt500++;
  }
}
```

#### 内部函数和外部函数
- 外部函数=全局函数=API函数=接口函数
- 内部函数=静态函数

#### 代码规范示例(.h文件)
```cpp
/*********************************************************************************************************
 * 模块名称: 
 * 摘    要: 
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/

#ifndef 

#define 

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              API函数声明
 *********************************************************************************************************/

#endif

```

#### 代码规范示例(.c文件)
 
```c
/*********************************************************************************************************
 * 模块名称: 
 * 摘    要: 
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部变量
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部函数声明
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部函数实现
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              API函数实现
 *********************************************************************************************************/

```


#### App.c
```c
#include <stdio.h>
#include <windows.h>
#pragma comment(lib, "winmm.lib") //导入winmm.lib多媒体库

#include "CalcTime.h"
#include "Tick.h"

static void InitSoftware(void); //初始化Software
static void __stdcall TimeProc(unsigned int uTimerID, unsigned int uMsg, unsigned long long dwUser, unsigned long long dw1, unsigned long long dw2); //定时器回调函数
static void Proc2msTask(void);  //声明一个2ms执行一次的函数
static void Proc1SecTask(void); //声明一个1sec执行一次的函数
void main(void)
```


```cpp

/*********************************************************************************************************
 * 模块名称: App.c
 * 摘    要: 测试基于多媒体定时器的电子钟设计实验
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/
#include <stdio.h>
#include <windows.h>
#pragma comment(lib, "winmm.lib") //导入winmm.lib多媒体库

#include "CalcTime.h"
#include "Tick.h"

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部变量
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部函数声明
 *********************************************************************************************************/
static void InitSoftware(void); //初始化Software

static void __stdcall TimeProc(unsigned int uTimerID, unsigned int uMsg, unsigned long long dwUser,unsigned long long dw1, unsigned long long dw2); //定时器回调函数

static void Proc2msTask(void);  //声明一个2ms执行一次的函数
static void Proc1SecTask(void); //声明一个1sec执行一次的函数

/*********************************************************************************************************
 *                                              内部函数实现
 *********************************************************************************************************/
/*********************************************************************************************************
 * 函数名称: InitSoftware
 * 函数功能: 所有的软件初始化函数都放在此函数中
 * 输入参数: void
 * 输出参数: void
 * 返 回 值: void
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
static void InitSoftware(void)
{
  InitCalcTime();
  InitTick();

  SetTickVal(80000); //设定初始化时间
}

/*********************************************************************************************************
 * 函数名称: TimeProc
 * 函数功能: 定时器回调函数
 * 输入参数: uTimerID，uMsg，dwUser，dw1，dw2，详见MSDN
 * 输出参数: void
 * 返 回 值: void
 * 创建日期: 2021年03月01日
 * 注    意:
 
 该函数名为 `TimeProc`，是一个静态函数（`static`），使用了 `__stdcall` 调用约定，意味着函数参数是通过栈传递的。
 *********************************************************************************************************/
static void __stdcall TimeProc(unsigned int uTimerID, unsigned int uMsg, unsigned long long dwUser, unsigned long long dw1, unsigned long long dw2)
{
  Proc2msTask();
}

/*********************************************************************************************************
 * 函数名称: Proc2msTask
 * 函数功能: 处理2ms任务
 * 输入参数: void
 * 输出参数: void
 * 返 回 值: void
 * 创建日期: 2021年03月01日
 * 注    意:

 总结来说，该函数的目的是在每个 2 毫秒的时间间隔内执行一些任务。在每个 500 个 2 毫秒的周期内（即 1 秒），会执行一次 `Proc1SecTask()` 函数。通过使用静态变量 `s_iCnt500` 追踪计数，并在计数达到一定阈值时执行特定任务，实现了周期性的任务执行。
 *********************************************************************************************************/
static void Proc2msTask(void)
{
  static short s_iCnt500 = 0;

  TickPer2Ms();//里面有一个s_icnt在记录时间,记录的是sec

  if (s_iCnt500 >= 499)
  {
    Proc1SecTask();//里面有一个GetTickVal函数在时刻提取TickPer2Ms中递增的tick值,得到该值之后这个ProclSecTask将其转换成时间值打印出信息
    s_iCnt500 = 0;
  }
  else
  {
    s_iCnt500++;
  }
}

/*********************************************************************************************************
 * 函数名称: Proc1SecTask
 * 函数功能: 处理1sec任务
 * 输入参数: void
 * 输出参数: void
 * 返 回 值: void
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
static void Proc1SecTask(void)
{
  int tickVal;
  short hour, min, sec;

  tickVal = GetTickVal();

  hour = CalcTime(tickVal, TIME_VAL_HOUR);
  min = CalcTime(tickVal, TIME_VAL_MIN);
  sec = CalcTime(tickVal, TIME_VAL_SEC);

  printf("Current time: %02d-%02d-%02d\n", hour, min, sec);
}

/*********************************************************************************************************
 *                                              API函数实现
 *********************************************************************************************************/
/*********************************************************************************************************
 * 函数名称: main
 * 函数功能: 主函数
 * 输入参数: void
 * 输出参数: void
 * 返 回 值: void
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
void main(void)
{
  InitSoftware(); //初始化软件

//创建一个以 2 毫秒为间隔、1 毫秒为分辨率的周期性定时器，当定时器触发时，会调用名为 `TimeProc` 的回调函数，并传递用户自定义的值为 0。
  timeSetEvent(2, 1, TimeProc, 0, TIME_PERIODIC);

//无限循环 `while (1)` 中等待程序的运行，因为定时器的触发将在后台处理//由于循环没有退出条件，程序将一直运行下去，直到被外部强制终止。
  while (1)
  {
  }
}

```

#### CalcHour.c
```c
#include "CalcHour.h"
void InitCalcHour(void)
short CalcHour(int tick)
```

```cpp
/*********************************************************************************************************
 * 模块名称: CalcHour.c
 * 摘    要: 计算小时
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/
#include "CalcHour.h"

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部变量
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部函数声明
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部函数实现
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              API函数实现
 *********************************************************************************************************/
/*********************************************************************************************************
 * 函数名称: InitCalcHour
 * 函数功能: 初始化小时计算模块
 * 输入参数: void
 * 输出参数: void
 * 返 回 值: void
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
void InitCalcHour(void)
{
}

/*********************************************************************************************************
 * 函数名称: CalcHour
 * 函数功能: 计算小时
 * 输入参数: tick，即以秒为单位的计数值
 * 输出参数: void
 * 返 回 值: 小时值
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
short CalcHour(int tick)
{
  short hour;

  hour = tick / 3600; // tick对3600取模赋值给hour

  return (hour);
}

```

#### CalcHour.h
```c
#ifndef _CALC_HOUR_H_
#define _CALC_HOUR_H_
void InitCalcHour(void);  //初始化CalcHour模块
short CalcHour(int tick); //计算小时值
#endif
```

```cpp
/*********************************************************************************************************
 * 模块名称: CalcHour.h
 * 摘    要: 计算小时
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/
#ifndef _CALC_HOUR_H_
#define _CALC_HOUR_H_

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              API函数声明
 *********************************************************************************************************/
void InitCalcHour(void);  //初始化CalcHour模块
short CalcHour(int tick); //计算小时值

#endif

```

#### CalcMin.c
```c
#include "CalcMin.h"
void InitCalcMin(void) //初始化分值计算
short CalcMin(int tick) //计算分值
```

```cpp
/*********************************************************************************************************
 * 模块名称: CalcMin.c
 * 摘    要: 计算分钟
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/
#include "CalcMin.h"

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部变量
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部函数声明
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部函数实现
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              API函数实现
 *********************************************************************************************************/
/*********************************************************************************************************
 * 函数名称: InitCalcMin
 * 函数功能: 初始化分钟计算模块
 * 输入参数: void
 * 输出参数: void
 * 返 回 值: void
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
void InitCalcMin(void)
{
}

/*********************************************************************************************************
 * 函数名称: CalcMin
 * 函数功能: 计算分钟
 * 输入参数: tick，即以秒为单位的计数值
 * 输出参数: void
 * 返 回 值: 分钟值
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
short CalcMin(int tick)
{
  short min;

  min = (tick % 3600) / 60; // tick对3600取余后再对60取模赋值给min

  return (min);
}

```

#### CalcMin.h
```c
#ifndef _CALC_MIN_H_
#define _CALC_MIN_H_
void InitCalcMin(void);  //初始化CalcMin模块
short CalcMin(int tick); //计算分钟值
#endif
```

```cpp
/*********************************************************************************************************
 * 模块名称: CalcMin.h
 * 摘    要: 计算分钟
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/
#ifndef _CALC_MIN_H_
#define _CALC_MIN_H_

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              API函数声明
 *********************************************************************************************************/
void InitCalcMin(void);  //初始化CalcMin模块
short CalcMin(int tick); //计算分钟值

#endif

```

#### CalcSec.c

```c
#include "CalcSec.h" 
void InitCalcSec(void) //初始化秒值计算函数
short CalcSec(int tick) //计算秒值
```

```cpp
/*********************************************************************************************************
 * 模块名称: CalcSec.c
 * 摘    要: 计算秒
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/
#include "CalcSec.h"

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部变量
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部函数声明
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部函数实现
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              API函数实现
 *********************************************************************************************************/
/*********************************************************************************************************
 * 函数名称: InitCalcSec
 * 函数功能: 初始化秒计算模块
 * 输入参数: void
 * 输出参数: void
 * 返 回 值: void
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
void InitCalcSec(void)
{
}

/*********************************************************************************************************
 * 函数名称: CalcSec
 * 函数功能: 计算秒
 * 输入参数: tick，即以秒为单位的计数值
 * 输出参数: void
 * 返 回 值: 秒值
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
short CalcSec(int tick)
{
  short sec;

  sec = (tick % 3600) % 60; // tick对3600取余后再对60取余赋值给sec

  return (sec);
}

```

#### CalcSec.h
```c
#ifndef _CALC_SEC_H_
#define _CALC_SEC_H_
void InitCalcSec(void);  //初始化CalcSec模块
short CalcSec(int tick); //计算秒值
#endif
```

```cpp
/*********************************************************************************************************
 * 模块名称: CalcSec.h
 * 摘    要: 计算秒
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/
#ifndef _CALC_SEC_H_
#define _CALC_SEC_H_

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              API函数声明
 *********************************************************************************************************/
void InitCalcSec(void);  //初始化CalcSec模块
short CalcSec(int tick); //计算秒值

#endif
```

#### CalcTime.c
```c
#include "CalcHour.h"
#include "CalcMin.h"
#include "CalcSec.h" //计算秒值分值时值的函数都在这三个头文件里面

#include "CalcTime.h" 
void InitCalcTime(void) //囊括秒值分值时值的三个初始化函数
short CalcTime(int tick, unsigned char type) //switch-case来囊括选择秒值分值时值的计算函数
```

```cpp
/*********************************************************************************************************
 * 模块名称: CalcTime.c
 * 摘    要: 秒值-时间换算
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/
#include "CalcHour.h"
#include "CalcMin.h"
#include "CalcSec.h"
#include "CalcTime.h"

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部变量
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部函数声明
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部函数实现
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              API函数实现
 *********************************************************************************************************/
/*********************************************************************************************************
 * 函数名称: InitCalcTime
 * 函数功能: 初始化CalcTime模块
 * 输入参数: void
 * 输出参数: void
 * 返 回 值: void
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
void InitCalcTime(void)
{
  InitCalcHour();
  InitCalcMin();
  InitCalcSec();
}

/*********************************************************************************************************
 * 函数名称: CalcTime
 * 函数功能: 计算时间
 * 输入参数: tick，即以秒为单位的计数值
 * 输出参数: void
 * 返 回 值: hour、min或sec，具体是哪一个根据type来确定
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
short CalcTime(int tick, unsigned char type)
{
  short timeVal;

  switch (type)
  {
  case TIME_VAL_HOUR:
    timeVal = CalcHour(tick); //通过调用CalcHour计算小时值
    break;
  case TIME_VAL_MIN:
    timeVal = CalcMin(tick); //通过调用CalcMin计算分钟值
    break;
  case TIME_VAL_SEC:
    timeVal = CalcSec(tick); //通过调用CalcSec计算秒值
    break;
  default:
    break;
  }

  return (timeVal);
}

```

#### CalcTime.h
```c
#ifndef _CALC_TIME_H_
#define _CALC_TIME_H_
typedef enum{} EnumTimeVal;
void InitCalcTime(void);                      //初始化CalcTime模块
short CalcTime(int tick, unsigned char type); //计算时间
#endif
```

```cpp
/*********************************************************************************************************
 * 模块名称: CalcTime.h
 * 摘    要: 秒值-时间换算
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/
#ifndef _CALC_TIME_H_
#define _CALC_TIME_H_

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/
//定义枚举
typedef enum
{
  TIME_VAL_HOUR = 0,
  TIME_VAL_MIN,
  TIME_VAL_SEC,
  TIME_VAL_MAX
} EnumTimeVal;

/*********************************************************************************************************
 *                                              API函数声明
 *********************************************************************************************************/
void InitCalcTime(void);                      //初始化CalcTime模块
short CalcTime(int tick, unsigned char type); //计算时间

#endif

```

#### Tick.c
```c
#include "Tick.h"
static int s_iTickVal //静态全局变量
void InitTick(void) //初始化tick值
void TickPer2Ms(void) //每2ms执行一次
void SetTickVal(int tick) //设置tick值
int GetTickVal(void) //获取tick值
```

```cpp
/*********************************************************************************************************
 * 模块名称: Tick.c
 * 摘    要: 时间滴答计数，以及时间值保存和获取
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/
#include "Tick.h"

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部变量
 *********************************************************************************************************/
static int s_iTickVal;

/*********************************************************************************************************
 *                                              内部函数声明
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              内部函数实现
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              API函数实现
 *********************************************************************************************************/
/*********************************************************************************************************
 * 函数名称: InitTick
 * 函数功能: 初始化Tick模块
 * 输入参数: void
 * 输出参数: void
 * 返 回 值: void
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
void InitTick(void)
{
  s_iTickVal = 0;
}

/*********************************************************************************************************
 * 函数名称: TickPer2Ms
 * 函数功能: 每2ms执行一次
 * 输入参数: void
 * 输出参数: void
 * 返 回 值: void
 * 创建日期: 2021年03月01日
 * 注    意:
 
 s_iCnt代表"static interval count"（静态间隔计数）或"static iteration count"（静态迭代计数）*********************************************************************************************************/
void TickPer2Ms(void)
{
  static short s_iCnt = 0;//静态局部变量

  if (s_iCnt >= 499)
  {
    if (s_iTickVal >= 86399)
    {
      s_iTickVal = 0;
    }
    else
    {
      s_iTickVal++;
    }
    s_iCnt = 0;
  }
  else
  {
    s_iCnt++;
  }
}

/*********************************************************************************************************
 * 函数名称: SetTickVal
 * 函数功能: 设置tick值
 * 输入参数: tick
 * 输出参数: void
 * 返 回 值: void
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
void SetTickVal(int tick)
{
  s_iTickVal = tick;
}

/*********************************************************************************************************
 * 函数名称: GetTickVal
 * 函数功能: 获取tick值
 * 输入参数: void
 * 输出参数: void
 * 返 回 值: tick值
 * 创建日期: 2021年03月01日
 * 注    意:
 *********************************************************************************************************/
int GetTickVal(void)
{
  return (s_iTickVal);
}

```

#### Tick.h
```c
#ifndef _TICK_H_
#define _TICK_H_
void InitTick(void);   //初始化Tick模块
void TickPer2Ms(void); //每2ms执行一次
void SetTickVal(int tick); //设置tick值
int GetTickVal(void);      //获取tick值
#endif
```

```cpp
/*********************************************************************************************************
 * 模块名称: Tick.h
 * 摘    要: 时间滴答计数，以及时间值保存和获取
 * 当前版本: 1.0.0
 * 作    者: Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
 * 完成日期: 2021年03月01日
 * 内    容:
 * 注    意:
 **********************************************************************************************************
 * 取代版本:
 * 作    者:
 * 完成日期:
 * 修改内容:
 * 修改文件:
 *********************************************************************************************************/
#ifndef _TICK_H_
#define _TICK_H_

/*********************************************************************************************************
 *                                              包含头文件
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              宏定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              枚举结构体定义
 *********************************************************************************************************/

/*********************************************************************************************************
 *                                              API函数声明
 *********************************************************************************************************/
void InitTick(void);   //初始化Tick模块
void TickPer2Ms(void); //每2ms执行一次

void SetTickVal(int tick); //设置tick值
int GetTickVal(void);      //获取tick值

#endif

```

![image.png](https://s2.loli.net/2023/07/14/AOCcXvrzhSnTtQP.png)

#### DataType.h
- 在编写代码时，可将一些较长关键字用缩写代替，如unsigned char用u8代替在DataType.h中，就用新数据类型名来代替已有的数据类型
- 另外，由于布尔型常量也常在程序中用到，这里在DataType.h中增加了TRUE和FALSE的定义。
```cpp
typedef signed char i8;
typedef signed short i16;
typedef signed int i32;
typedef unsigned char u8;
typedef unsigned short u16;                                                                    
typedef unsigned int u32;

#define TRUE 1
#define FALSE 0
```

#### timeSetEvent库函数介绍
```cpp
MMRESULT timeSetEvent(
UINT           uDelay,        //以毫秒指定事件的周期
UINT           uResolution,   //以毫秒指定延时的精度，数值越小定时器事件分辨率越高，省值为1ms
LPTIMECALLBACK lpTimeProc,    //指向一个回调函数，即单次事件触发时，或者周期性事件触发时调用的函数
DWORD_PTR      dwUser,        //存放用户提供的回调数据
UINT           fuEvent        //指定定时器事件类型，TIME_ONESHOT-单次触发，TIME_PERIODIC-周期性触发
);
//用户定时器设定，定时器精度为1ms，每隔2ms触发一次定时器，并执行回调函数TimeProc

//创建一个以 2 毫秒为间隔、1 毫秒为分辨率的周期性定时器，当定时器触发时，会调用名为 `TimeProc` 的回调函数，并传递用户自定义的值为 0。
timeSetEvent(2, 1, TimeProc, 0, TIME_PERIODIC);
```

